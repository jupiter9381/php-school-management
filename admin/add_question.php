<?php include("header.php"); ?><?php$error = "";$success = "";if(isset($_REQUEST['id'])) {        $recordid = $_REQUEST['id'];    $data = mysqli_fetch_array(mysqli_query($db, "SELECT * FROM student_questions WHERE student_questions_id = '$recordid' "));    // echo "SELECT * FROM student_answer WHERE student_answer_id = '$recordid' ";    $data11 = mysqli_fetch_array(mysqli_query($db, "SELECT * FROM student_answer WHERE student_questions_id = '$recordid' "));    $query1 = mysqli_fetch_array(mysqli_query($db, "SELECT * FROM categories WHERE category_id = '".$query['category_id']."' "));}?><section id="middle">    <header id="page-header">        <h1>Questions</h1>    </header>    <div id="content" class="padding-20">        <div class="row">            <div class="col-md-12">                <div class="panel panel-default mypanel">                    <div class="panel-heading panel-heading-transparent">                        <strong>Questions Details</strong>                    </div>                    <div class="panel-body">                        <form id="formaddstudentquestions" action="" method="post" enctype="multipart/form-data">                            <fieldset>                                                <div class="row">                                    <div class="form-group">                                        <div class="col-md-6 col-sm-6 ">                                    <label>Test Name *</label>                                    <div class="fancy-form fancy-form-select">                                        <select class="form-control select2"  id="test_name" name="test_name_id" required >                                                <option value="">--Select--</option>                                            <?php                                                $selectpck2 = "SELECT * FROM student_test";                                                $sql2 = mysqli_query($db, $selectpck2);                                            while ($row2 = mysqli_fetch_array($sql2)) {                                                $selected2 = (isset($data['test_name_id']) && $row2['test_name_id'] == $data['test_name_id'])?'selected':'';                                            ?>                                                <option value="<?php echo $row2['test_name_id']; ?>" <?=$selected2; ?>><?php echo $row2['test_name']; ?></option>                                                                                        <?php }?>                                         </select>                                    </div>                                </div>                                <div class="clearfix"></div>                                    </div>                                </div>                                                                                <div class="row">                                    <div class="form-group">                                        <div class="col-md-12 col-sm-12">                                            <label>Question</label>                                                <textarea rows="2"  class = "form-control" name = "questions" id = "questions" title = "questions Required" value="" required><?php echo isset($data['questions'])?$data['questions']:''?> </textarea>                                                                                        </div>                                    </div>                                </div>                          <div class="row">                            <div class="form-group">                              <div class="col-md-12 col-sm-12">                                <label>Answer</label><br>                                  <?php  if(isset($_REQUEST['id'])) {                                    $answer_array = explode(',', $data11['answer']);                                    $correct_answer_array = explode(',', $data11['correct_answer']);                                    $i = 0;                                    foreach ($answer_array as $key => $value) {                                    ?>                                      <div id="repeat_ans" class="repeated_ans ">                                        <div class="col-md-10 col-sm-10">                                          <div class="form-group clearfix ">                                                                                        <textarea class="form-control edittext " name="question_option[]" id="answer" <?php isset($_REQUEST['id']) ? "" : 'required'; ?>><?php echo  htmlentities($value);?></textarea>                                          </div>                                        </div>                                        <div class="col-md-1 col-sm-1">                                          <div class="form-group clearfix">                                            <div class="fancy-form ">                                              <select class="form-control" name="is_answer[]">                                                <option value="1" <?php echo $correct_answer_array[$i] == 1?"selected":""; ?>>Yes</option>                                                <option value="0" <?php echo $correct_answer_array[$i] == 0 ?"selected":""; ?>>No</option>                                              </select>                                              <i class="fancy-arrow"></i>                                            </div>                                          </div>                                        </div>                                        <div class="col-md-1 col-sm-1">                                          <a href="javascript:void(0);" id="remove_ans" class="btn-xs btn-danger remove_answer" onclick="return remove_answers(<?php echo $ans_id; ?>)"><i class="fa fa-minus"></i></a>                                        </div>                                        <?php if(isset($data['attachment']) && !empty($data['attachment'])){?>                                        <div class="col-md-3"><a href="<?php echo '../uploads/answer/'.$data['attachment']?>" target="_blank">View Attachment</a><div class="clearfix"></div></div>                                        <?php }?>                                                                                  <div class="col-md-1 col-sm-1">                                          <?php if(isset($ans['attachment']) && !empty($ans['attachment'])){?>                                          <label>                                            Attachment                                          </label>                                          <div class="col-md-1 col-sm-1">                                            <a href="../uploads/answer/<?php  echo $ans['attachment'];?>" target="_blank">Click here</a>                                          </div>                                          <?php }                                             ?>                                        </div>                                      </div>                                      <div class="clearfix"></div><br>                                    <?php $i++;                                    } // while end ?>                            <div id="repeat_ans">                               <div class="col-md-10 col-sm-10" >                                <div class="form-group clearfix">                                  <input type="hidden" name="question_option_id[]" value="">                                  <textarea class = "form-control edittext" name = "question_option[]" id = "question_option" ></textarea>                                                                  </div>                               </div>                               <!-- <div class="col-md-3 col-sm-3">                                 <div class="form-group clearfix">                                  <textarea placeholder = "Answer Explaination" class = "form-control" name = "opt_explain[]" id = "opt_explain"   value="<?php  echo isset($query['opt_explain'])?$query['opt_explain']:'';?>" style="height:40px;" tabindex="100"><?php  echo isset($query['opt_explain'])?$query['opt_explain']:'';?></textarea>                                 </div>                               </div> -->                               <div class="col-md-1 col-sm-1">                                  <div class="form-group clearfix">                                     <div class="fancy-form ">                                       <select class="form-control"  name="is_answer[]" tabindex="100">                                         <option value="1">Yes</option>                                         <option value="0" selected>No</option>                                       </select>                                       <i class="fancy-arrow"></i>                                     </div>                                  </div>                                             <!--<label class="checkbox">                                                 <input type="checkbox" class="is_ans" name="is_answer[]" value="0">                                                 <i></i> Is Answer?                                             </label> -->                                </div>                                                                  </div>                             <div class="col-md-1 col-sm-1">                                 <a href="javascript:void(0);" id="repeat_button" class=" btn-xs btn-warning text-center"><i class="fa fa-plus"></i></a>                             </div>                             <div class="clearfix"></div><br>                                      <div id="extra_ans">                                     </div>                                    <?php                                                  } // if end                                   else {?>                                          <div class="repeated_ans" id="repeat_ans">                                <div class="col-md-10 col-sm-10">                                    <div class="form-group clearfix">                                             <input type="hidden" name="question_option_id[]" value="<?php echo $ans_id; ?>">                                         <textarea class = "form-control edittext" name = "question_option[]" id = "question_option" <?php  echo isset($_REQUEST['id'])?"":'required'?>  tabindex="1" ><?php  //echo isset($ans['question_option'])?$ans['question_option']:'';?></textarea>                                                                                                                           </div>                                     </div>                       <!-- <div class="col-md-3 col-sm-3">                          <div class="form-group clearfix">                             <textarea placeholder = "Answer Explaination" class = "form-control" name = "opt_explain[]" id = "opt_explain"   value="<?php  echo isset($query['opt_explain'])?$query['opt_explain']:'';?>" style="height:40px;" tabindex="100"><?php  echo isset($query['opt_explain'])?$query['opt_explain']:'';?></textarea>                          </div>                       </div> -->                      <div class="col-md-1 col-sm-1">                                <div class="form-group clearfix">                                   <div class="fancy-form ">                                     <select class="form-control"  name="is_answer[]" tabindex="100">                                       <option value="1">Yes</option>                                       <option value="0" selected>No</option>                                     </select>                                     <i class="fancy-arrow"></i>                                   </div>                                 </div>                                             <!--<label class="checkbox">                                                 <input type="checkbox" class="is_ans" name="is_answer[]" value="0">                                                 <i></i> Is Answer?                                             </label> -->                      </div>                                            <div class="col-md-1 col-sm-1">                            <a href="javascript:void(0);" id="remove_ans" class="btn-xs btn-danger remove_answer" onclick="return remove_answers(<?php echo $ans_id; ?>)"><i class="fa fa-minus"></i></a>                        </div>                                          </div>                        <div class="clearfix"></div><br>                          <div class="repeated_ans" id="repeat_ans">                            <div class="col-md-10 col-sm-10">                              <div class="form-group clearfix">                                    <input type="hidden" name="question_option_id[]" value="<?php echo $ans_id; ?>">                                <textarea class = "form-control edittext" name = "question_option[]" id = "question_option" <?php  echo isset($_REQUEST['id'])?"":'required'?>  tabindex="1" ><?php // echo isset($ans['question_option'])?$ans['question_option']:'';?></textarea>                              </div>                                 </div>                     <!-- <div class="col-md-3 col-sm-3">                         <div class="form-group clearfix">                            <textarea placeholder = "Answer Explaination" class = "form-control" name = "opt_explain[]" id = "opt_explain"   value="<?php  echo isset($query['opt_explain'])?$query['opt_explain']:'';?>" style="height:40px;" tabindex="100"><?php  echo isset($query['opt_explain'])?$query['opt_explain']:'';?></textarea>                         </div>                     </div> -->                       <div class="col-md-1 col-sm-1">                          <div class="form-group clearfix">                             <div class="fancy-form ">                               <select class="form-control"  name="is_answer[]" tabindex="100">                                 <option value="1">Yes</option>                                 <option value="0" selected>No</option>                               </select>                               <i class="fancy-arrow"></i>                             </div>                           </div>                                                  </div>                                               <div class="col-md-1 col-sm-1">                          <a href="javascript:void(0);" id="remove_ans" class="btn-xs btn-danger remove_answer" onclick="return remove_answers(<?php echo $ans_id; ?>)"><i class="fa fa-minus"></i></a>                       </div>                                                                  </div>                  <div class="clearfix"></div><br>                  <div class="repeated_ans" id="repeat_ans">                    <div class="col-md-10 col-sm-10">                      <div class="form-group clearfix">                            <input type="hidden" name="question_option_id[]" value="<?php echo $ans_id; ?>">                        <textarea class = "form-control edittext" name = "question_option[]" id = "question_option" <?php  echo isset($_REQUEST['id'])?"":'required'?>  tabindex="1" ><?php  //echo isset($ans['question_option'])?$ans['question_option']:'';?></textarea>                      </div>                         </div>                      <!-- <div class="col-md-3 col-sm-3">                         <div class="form-group clearfix">                            <textarea placeholder = "Answer Explaination" class = "form-control" name = "opt_explain[]" id = "opt_explain"   value="<?php  echo isset($query['opt_explain'])?$query['opt_explain']:'';?>" style="height:40px;" tabindex="100"><?php  echo isset($query['opt_explain'])?$query['opt_explain']:'';?></textarea>                         </div>                      </div> -->                      <div class="col-md-1 col-sm-1">                        <div class="form-group clearfix">                          <div class="fancy-form ">                            <select class="form-control"  name="is_answer[]" tabindex="100">                              <option value="1">Yes</option>                              <option value="0" selected>No</option>                            </select>                              <i class="fancy-arrow"></i>                          </div>                        </div>                                                                  </div>                                          <div class="col-md-1 col-sm-1">                        <a href="javascript:void(0);" id="remove_ans" class="btn-xs btn-danger remove_answer" onclick="return remove_answers(<?php echo $ans_id; ?>)"><i class="fa fa-minus"></i></a>                      </div>                      <?php if(isset($data['attachment']) && !empty($data['attachment'])){?>                      <div class="col-md-3"><a href="<?php echo '../uploads/answer/'.$data['attachment']?>" target="_blank">View Attachment</a><div class="clearfix"></div>                      </div>                        <?php }?>                                                              </div>                      <div class="clearfix"></div><br>                                         <div id="repeat_ans">                        <div class="col-md-10 col-sm-10">                          <div class="form-group clearfix">                                   <input type="hidden" name="question_option_id[]" value="<?php echo $ans_id; ?>">                               <textarea class = "form-control edittext" name = "question_option[]" id = "question_option" <?php  echo isset($_REQUEST['id'])?"":'required'?>  tabindex="1" ><?php  //echo isset($ans['question_option'])?$ans['question_option']:'';?></textarea>                                                                                            </div>                             </div>                       <!-- <div class="col-md-3 col-sm-3">                          <div class="form-group clearfix">                            <textarea placeholder = "Answer Explaination" class = "form-control" name = "opt_explain[]" id = "opt_explain"   value="<?php  echo isset($query['opt_explain'])?$query['opt_explain']:'';?>" style="height:40px;" tabindex="100"><?php  echo isset($query['opt_explain'])?$query['opt_explain']:'';?></textarea>                          </div>                       </div> -->                       <div class="col-md-1 col-sm-1">                          <div class="form-group clearfix">                            <div class="fancy-form ">                              <select class="form-control"  name="is_answer[]" tabindex="100">                              <option value="1">Yes</option>                              <option value="0" selected>No</option>                              </select>                               <i class="fancy-arrow"></i>                            </div>                          </div>                                                  </div>                                              <div class="col-md-1 col-sm-1">                          <a href="javascript:void(0);" id="repeat_button" class=" btn-xs btn-warning text-center"><i class="fa fa-plus"></i></a>                       </div>                                            </div>                      <div class="clearfix"></div><br>                                                           <div id="extra_ans">                      </div>                      <?php }?>                    </div>              </div>          </div>                                                                                        <div class="row">                                  <div class="form-group">                                    <div class="col-md-12 col-sm-12">                                      <label>Question Marks</label>                                        <div class="fancy-form"><!-- input -->                                          <i class="fa fa-hdd-o"></i>                                          <input type="number"  placeholder = "Question Marks" class = "form-control" name = "question_marks" id = "question_marks"   value="<?php  echo isset($data['question_marks'])?$data['question_marks']:''?>" >                                        </div>                                      </div>                                  </div>                                </div>                                                               <div class="row">                                  <div class="form-group">                                    <div class="col-md-12 col-sm-12 text-center">                                       <input type ="hidden" name = "txtid" id="txtid" value="<?php echo isset($recordid)?$recordid:'';?>">                                        <input type ="hidden" name = "type" value="Addstudentquestions">                                        <input type="submit" id="formvalidate" data-form="formaddstudentquestions"  class="btn btn-info btn-md btn-submit"  value="Add Questions">                                    </div>                                  </div>                                </div>                                                                                         </fieldset>                        </form>                    </div>                                            </div>                            </div>        </div>    </div></section><!-- /MIDDLE --><?php include("footer.php"); ?><script>    var iswhich = 0;  var btn_hidden;  $('.btn_submit').click(function(){    iswhich = 1;    btn_hidden = $(this);    $("#questionform").submit();  });  $('.btn_proceed').click(function(){    iswhich = 2;    btn_hidden = $(this);    $("#questionform").submit();  });  $("#questionform").submit(function(e)  {        e.preventDefault();    var isone = 0;    /*$('select[name="is_answer_1[]"]').each(function(index, elem) {      console.log($(elem).val());      isone = isone+parseFloat($(elem).val());    });*/    $('select[name="is_answer[]"]').each(function(index, elem) {      console.log($(elem).val());      isone = isone+parseFloat($(elem).val());    });        if(isone == 0)    {      _toastr("There should be atleat one answer","bottom-right","info",false);      return false;    }    else if(isone > 1)    {      _toastr("There can be only one answer","bottom-right","info",false);      return false;    }    else    {      //for ( instance in CKEDITOR.instances )      //CKEDITOR.instances[instance].updateElement();      $elm = btn_hidden;      $elm.hide();      $elm.after('<i class="fa fa-spinner fa-pulse fa-1x fa-fw submit-loading"></i>');      $form = $(this);      var formData = new FormData(this);      $.ajax({        type        : "POST",        url         : "../functions",        data:formData,        cache:false,        contentType: false,        processData: false,        success        : function(resp){          resp = JSON.parse(resp);          if(resp.success)          {            _toastr(resp.msg,"bottom-right","success",false);            setTimeout(function(){              location.reload();              /*if(iswhich == 2)              {                location.reload();              }              else{                location.href='question';              }*/            }, 2000);          }else          {            _toastr(resp.msg,"bottom-right","info",false);          }          $elm.show();          $(".submit-loading").remove();        },        error: function(data){        }      });    }            });    var i = 0;  var j = 2;    $("#repeat_button").click(function(){    var c1 = j++;    var c = i++;       var ans = '<div id="repeat_ans'+c+'" class="repeated_ans">'+                        '<div class="col-md-10 col-sm-10">'+                            '<div class="form-group clearfix">'+                              '<input type="hidden" name="question_option_id[]" value="<?php echo $ans_id; ?>" />'+                             '<textarea class="form-control edittext" name="question_option[]" id="question_option"<?php isset($_REQUEST['id']) ? "" : 'required'; ?>" > <?php  echo isset($ans['question_option']) ? htmlentities($ans['question_option']) :''; ?> </textarea>'+                                                      '</div>'+                        '</div>'+                       /*' <div class="col-md-3 col-sm-3">'+              '<div class="form-group clearfix">'+                '<textarea placeholder = "Answer Explaination" class = "form-control" name = "opt_explain[]" id = "opt_explain"  tabindex="100" value="<?php  echo isset($query['opt_explain'])?$query['opt_explain']:'';?>" style="height:40px;" ><?php  echo isset($query['opt_explain'])?$query['opt_explain']:'';?></textarea>'+                        '</div>'+                        '</div>'+*/                       '<div class="col-md-1 col-sm-1">'+              '<div class="form-group clearfix">'+                           '<div class="fancy-form ">'+                                '<select class="form-control"  name="is_answer[]" tabindex="100">'+                                    '<option value="1">Yes</option>'+                                    '<option value="0" selected>No</option>'+                                '</select>'+                                 '<i class="fancy-arrow"></i>'+                            '</div>'+                        '</div>'+                        '</div>'+                                               '<div class="col-md-1 col-sm-1">'+                            '<a href="javascript:void(0);"  id="remove_ans'+c+'" class="btn-xs btn-danger remove_answer"><i class="fa fa-minus"></i></a>'+                       '</div>'+                '</div>'+'<div class="clearfix"></div>'+'<br>';        $(ans).clone().appendTo("#extra_ans");    });      $(document).on('click','.remove_answer',function () {        $(this).closest(".repeated_ans").remove();    });    $("#questionform").on('click', '.is_ans', function()    {       if($(this).is(':checked'))       {           $(this).attr("value","1");       }       else       {           $(this).attr("value","0");       }    });    //Delete answers from database    function remove_answers(id)    {        $.ajax({            type  : "POST",            url   : "../functions",            data:{               recordid:id,                type : 'delete_answers_db'            },            success : function(resp){               /* resp = JSON.parse(resp);                if(resp.success){                    _toastr(resp.msg,"bottom-right","success",false);                    setTimeout(function(){                       // location.reload();                    }, 2000);                }else{                    _toastr(resp.msg,"bottom-right","info",false);                }                $elm.show();                $(".submit-loading").remove(); */            },            error: function(data){            }        });    }    // hide and show    $(".active_main").change( function()    {        if($(this).is(':checked') &&  $(this).val() == "1")        {            $("#check_active").show();        }        else        {            $("#check_active").hide();        }    });//CKEDITOR.replace( 'question' );</script><script>//change course category$("body").on("change", ".changecategory1", function () {      var subid = $(this).val();    $elm = $("#sub_category1");    $.ajax({            type: "POST",        url:  "../functions",        data: {subid: subid, type: "Selectchildcategory1"},        success: function (resp) {            resp = jQuery.parseJSON(resp);            if (resp.valid) {                $depart = resp.sub_id;                $elm.html('<option>Select Sub Category</option>');                for (var i = 0; i < $depart.length; i++) {                    $elm.append('<option value="' + $depart[i].sub_id + '">' + $depart[i].sub_name + '</option>');                }            } else {        $elm.html('<option>Select Sub Category</option>');                return false;            }        },        error: function () {            console.log(resp);        }    });});$("body").on("change", ".changecategory2", function () {    var subid = $(this).val();  //alert(subid);    $elm = $("#sub_category2");    $.ajax({            type: "POST",        url:  "../functions",        data: {subid: subid, type: "Selectchildcategory2"},        success: function (resp) {            resp = jQuery.parseJSON(resp);            if (resp.valid) {                $depart = resp.child_cat_id;                $elm.html('<option>Select Sub Category</option>');                for (var i = 0; i < $depart.length; i++) {                    $elm.append('<option value="' + $depart[i].child_cat_id + '">' + $depart[i].child_cat_name + '</option>');                }            } else {        $elm.html('<option>Select Sub Category</option>');                return false;            }        },        error: function () {            console.log(resp);        }    });});$("body").on("change", ".changecategory3", function () {    var subid = $(this).val();  //alert(subid);    $elm = $("#sub_category3");    $.ajax({        type: "POST",        url:  "../functions",        data: {subid: subid, type: "Selectchildcategory3"},        success: function (resp) {            resp = jQuery.parseJSON(resp);      //alert(resp);      //alert(subid);            if (resp.valid) {                $depart = resp.category_id;        //alert($depart);                $elm.html('<option>--- Course Name ---</option>');                for (var i = 0; i < $depart.length; i++) {                    $elm.append('<option value="' + $depart[i].category_id + '">' + $depart[i].category_name + '</option>');                }            } else {        $elm.html('<option>Select Sub Category</option>');                return false;            }        },        error: function () {            console.log(resp);        }    });});  $("body").on('click', 'input[name=question_type]', function() {        if ($(this).is(':checked')) {            $('#para_graph').prop("required",true);            $('#para_graph').show();        }        else {            $('#para_graph').prop("required",false);            $('#para_graph').hide();        }    });</script><script>    $(function() {      /*$('.edittext').froalaEditor({        // Set the file upload URL.        //fileUploadURL: '/upload_file.php',         fileUploadParams: {          id: 'my_editor'        }      })*/            $('.edittext').froalaEditor({             // Add WIRIS EDITOR buttons to Image Toolbar.      imageEditButtons: ['wirisEditor', 'wirisChemistry', 'imageDisplay', 'imageAlign', 'imageInfo', 'imageRemove'],       // Add WIRIS EDITOR buttons to Toolbar.      toolbarButtons: ['undo', 'redo' , 'bold', 'insertImage', 'insertVideo',  'italic','underline', '|', 'wirisEditor', 'wirisChemistry','clear', 'insert','imageReplace', 'imageAlign', 'imageRemove', '|', 'imageLink', 'linkOpen', 'linkEdit', 'linkRemove', '-', 'imageDisplay', 'imageStyle', 'imageAlt', 'imageSize', 'insertTable'],      // Allowed tags      htmlAllowedTags:   ['.*'],      htmlAllowedAttrs: ['.*'],       /*imageEditButtons: ['imageReplace', 'imageAlign', 'imageRemove', '|', 'imageLink', 'linkOpen', 'linkEdit', 'linkRemove', '-', 'imageDisplay', 'imageStyle', 'imageAlt', 'imageSize'],*/      //fileUploadURL: '/upload_file.php',      fileUploadParams: {          id: 'my_editor'        }    });      $('#question').froalaEditor('events.focus', true);    });  $(document).ready(function() {      $('#repeat_button').click(function (e) {        e.preventDefault();                        $('<textarea class = "form-control edittext" name = "question_option[]" id = "question_option" <?php  //echo isset($_REQUEST['id'])?"":'required'?> value="<?php echo isset($query['question_option'])? htmlspecialchars($query['question_option']):''?>  ><?php //echo isset($query['question_option'])?$query['question_option']:''?></textarea>')          .appendTo('.edittext')          $('.edittext').froalaEditor({                               fileUploadParams: {            id: 'my_editor'          }        });      });    });    $('head').append('<script src="../froala_editor/js/plugins/wiris/wiris.js"></script>');  </script>